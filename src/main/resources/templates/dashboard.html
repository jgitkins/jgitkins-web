<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>JGitkins Dashboard</title>
	<link rel="stylesheet" th:href="@{/css/app.css}">
	<script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body>
<div class="page">
	<nav class="nav">
		<div class="brand">
			<span class="brand__mark">JG</span>
			<div class="brand__meta">
				<p class="brand__title">JGitkins</p>
				<p class="brand__subtitle">Live Dashboard</p>
			</div>
		</div>
		<div class="nav__links">
			<a href="/dashboard" class="nav__link is-active">Dashboard</a>
			<a href="#feed" class="nav__link">Feed</a>
			<a href="/explore" class="nav__link">Explore</a>
		</div>
		<form th:action="@{/logout}" method="post" class="nav__logout">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
			<button type="submit" class="ghost">로그아웃</button>
		</form>
	</nav>

	<header class="hero hero--compact">
		<div class="hero__content">
			<h1>접근 가능한 저장소와 활동을 한 번에 확인하세요.</h1>
			<p>Google 계정으로 로그인된 사용자 기준으로 조직/저장소 정보를 수집합니다.</p>
		</div>
		<div class="hero__meta">
			<span>마지막 동기화</span>
			<strong th:text="${#temporals.format(lastUpdated, 'yyyy-MM-dd HH:mm:ss')}">업데이트</strong>
		</div>
	</header>

	<main>
		<div th:replace="fragments/organizes :: list"></div>

		<section class="panel">
			<div class="panel__header">
				<div>
					<h2>접근 가능한 저장소</h2>
					<p>조직 및 개인 저장소를 한 번에 보여줍니다.</p>
				</div>
				<div class="panel__meta">
					<span>PR/MR · 이슈 연동 준비 중</span>
				</div>
			</div>

			<div class="panel__body">
				<div class="empty" th:if="${#lists.isEmpty(dashboard.repositories())}">
					<p>표시할 저장소가 없습니다.</p>
				</div>
				<div class="repo-list" th:if="${!#lists.isEmpty(dashboard.repositories())}">
					<div class="repo-card" th:each="repo : ${dashboard.repositories()}">
						<div class="repo-card__header">
							<div>
								<h3>[[${repo.namespace()}]] / [[${repo.repoName()}]]</h3>
								<p th:text="${repo.repository().description()}">설명</p>
							</div>
							<span class="badge" th:text="${repo.repository().visibility()}">PRIVATE</span>
						</div>
						<div class="repo-card__meta">
							<span>기본 브랜치: [[${repo.repository().defaultBranch()}]]</span>
							<span>최근 동기화: [[${repo.repository().lastSyncedAt()}]]</span>
						</div>
						<div class="repo-card__stats">
							<a class="stat-link"
							   th:classappend="${repo.pullRequestLink() == null} ? 'is-disabled' : ''"
							   th:href="${repo.pullRequestLink() != null ? repo.pullRequestLink() : '#'}">
								PR/MR [[${repo.pullRequestCount()}]]
							</a>
							<a class="stat-link"
							   th:classappend="${repo.issueLink() == null} ? 'is-disabled' : ''"
							   th:href="${repo.issueLink() != null ? repo.issueLink() : '#'}">
								Issues [[${repo.issueCount()}]]
							</a>
						</div>
						<div class="commit-list">
							<div class="commit" th:if="${#lists.isEmpty(repo.recentCommits())}">
								<p>커밋 이력이 없습니다.</p>
							</div>
							<div class="commit" th:each="commit : ${repo.recentCommits()}">
								<div>
									<h4>[[${commit.shortMessage()}]]</h4>
									<p>[[${commit.authorName()}]] · [[${#temporals.format(commit.commitTime(), 'yyyy-MM-dd HH:mm')}]]</p>
								</div>
								<span class="commit-hash">[[${commit.id()}]]</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div id="feed" th:replace="fragments/feed :: list"></div>
	</main>
</div>
</body>
</html>
